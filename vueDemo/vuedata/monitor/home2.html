<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Document</title>
  <script type="text/javascript" src="../js/jquery-1.11.3.min.js"></script>
  <script src="../vue-2.5.17/dist/vue.js"></script>
  <script src="../js/echarts.min.js"></script>
  <script src="../js/layui/layui.js"></script>
  <link rel="stylesheet" href="../js/layui/css/layui.css">
  <link rel="stylesheet" href="css/common.css" />
</head>

<body>
  <div id="app">
    <div class="zf-header">
      XSKY
    </div>

    <div class="zf-container">
      <div class="row">
        <div class="col-12 col-sm-12">
          <div class="panel" style="height: 302px;">
            <h1>集群监控</h1>
            <div class="chart" id="cluster">
            </div>
          </div>
        </div>

        <div class="col-3 col-sm-4 ">
          <div class="panel" style="height: 192px;">
            <h1>集群容量使用</h1>
            <div class="chart" id="cluster-capacity">
            </div>
          </div>
        </div>
        <div class="col-3 col-sm-4 ">
          <div class="panel" style="height: 192px;">
            <h1>集群监控</h1>
            <div class="chart">
            </div>
          </div>
        </div>
        <div class="col-3 col-sm-4 ">
          <div class="panel" style="height: 192px;">
            <h1>集群监控</h1>
            <div class="chart">
            </div>
          </div>
        </div>
        <div class="col-3 col-sm-4 ">
          <div class="panel" style="height: 192px;">
            <h1>集群监控</h1>
            <div class="chart">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    var app = new Vue({
      el: '#app',
      data: {
        // datas: []
        // departmentlinks: []
      },
      mounted() {
        var json = 'link.json'
        this.$nextTick(function () {
          var that = this
          // that.intervalid = setInterval(function () {
          $.ajax({
            type: 'get',
            url: json,
            dataType: 'json',
            success: function (data) {
              that.lineechart(data.linesdatas)
              that.pieechart(data.capacitydatas)
            }
          })
          // }, 5000)
        })
      },
      methods: {
        lineechart: function (data) {
          console.log(data)
          var data1 = {};
          data1.name = [];
          data1.read = [];
          data1.write = [];
          data1.restore = [];
          var data2 = {};
          data2.name = [];
          data2.read = [];
          data2.write = [];
          data2.restore = [];
          data.iops.forEach(function (item) {
            data1.name.push(item.name)
            data1.read.push(item.read)
            data1.write.push(item.write)
            data1.restore.push(item.restore)
          })
          data.bandwidth.forEach(function (item) {
            data2.name.push(item.name)
            data2.read.push(item.read)
            data2.write.push(item.write)
            data2.restore.push(item.restore)
          })
          option = {
            title: [{
              text: "IOPS",
              left: 20,
              top: 10
            }, {
              text: "带宽",
              left: '50%',
              top: 10
            }],
            legend: [{
              left: '18%',
              top: '20',
              data: ["读", "写", "恢复"]
            }, {
              left: '68%',
              top: '20',
              data: ["读", "写", "恢复"]
            }],
            tooltip: {
              trigger: 'axis'
            },
            color: ['#47a2ff', '#ffc100', '#337ab7'],
            // ['#47a2ff', '#ffc100', '#aec785']
            // ],
            xAxis: [{
              type: 'category',
              boundaryGap: false,
              data: data1.name
              // data: ['13:45', '13:50', '13:55', '14:00', '14:05', '14:10', '14:15']
            }, {
              type: 'category',
              boundaryGap: false,
              gridIndex: 1,
              data: data2.name
              // data: ['13:45', '13:50', '13:55', '14:00', '14:05', '14:10', '14:15']
            }],
            yAxis: [{
              type: 'value'
            }, {
              type: 'value',
              gridIndex: 1,
            }],
            grid: [{
              left: 60,
              right: '53%'
            }, {
              left: '53%',
              right: 40
            }],
            series: [{
              name: '读',
              data: data1.read,
              // data: [1000, 1220, 1401, 900, 800, 1230, 1320],
              type: 'line',
              areaStyle: {
                color: '#47a2ff',
                opacity: 0.5
              }
            }, {
              name: '写',
              data: data1.write,
              // data: [820, 932, 901, 934, 1290, 1330, 1320],
              type: 'line',
              areaStyle: {
                color: '#ffc100',
                opacity: 0.5
              }
            }, {
              name: '恢复',
              data: data1.restore,
              // data: [120, 232, 401, 534, 390, 230, 320],
              type: 'line',
              areaStyle: {
                color: '#337ab7',
                opacity: 0.5
              }
            }, {
              name: '读',
              data: data2.read,
              // data: [1000, 1220, 1401, 900, 800, 1230, 1320],
              type: 'line',
              areaStyle: {
                color: '#47a2ff',
                opacity: 0.5
              },
              xAxisIndex: 1,
              yAxisIndex: 1
            }, {
              name: '写',
              data: data2.write,
              // data: [820, 932, 901, 934, 1290, 1330, 1320],
              type: 'line',
              areaStyle: {
                color: '#ffc100',
                opacity: 0.5
              },
              xAxisIndex: 1,
              yAxisIndex: 1
            }, {
              name: '恢复',
              data: data2.restore,
              // data: [120, 232, 401, 534, 390, 230, 320],
              type: 'line',
              areaStyle: {
                color: '#aec785',
                opacity: 0.5
              },
              xAxisIndex: 1,
              yAxisIndex: 1
            }]
          };
          var chart = echarts.init(document.getElementById('cluster'));
          chart.setOption(option);
        },
        pieechart: function (data) {
          var piename = [];
          var total = 0;
          data.datas.forEach(function (item) {
            piename.push(item.name)
            total += parseFloat(item.value)
          })
          console.log(total)
          option2 = {
            title: {
              text: '{a|总计}\n' + total + '\n{a|TB}',
              left: '28%',
              top: 'middle',
              textAlign: 'center',
              textStyle: {
                fontSize: 24,
                rich: {
                  a: {
                    fontSize: 14,
                    color: '#aaa',
                    height: 25
                  },
                }
              }
            },
            tooltip: {
              trigger: 'item',
              formatter: "{a} <br/>{b}: {c} ({d}%)"
            },
            legend: {
              orient: 'vertical',
              x: 'left',
              left: '60%',
              top: 'middle',
              data: piename
            },
            series: [{
              name: '容量使用',
              type: 'pie',
              radius: ['65%', '80%'],
              center: ['30%', '50%'],
              avoidLabelOverlap: false,
              label: {
                normal: {
                  show: false,
                },

              },
              labelLine: {
                normal: {
                  show: false
                }
              },
              data: data.datas
            }]
          };

          var chart2 = echarts.init(document.getElementById('cluster-capacity'));
          chart2.setOption(option2);
        }
      }
    })


    // window.addEventListener("resize", function () {
    //   chart.resize();
    //   chart2.resize();
    // })
  </script>
</body>